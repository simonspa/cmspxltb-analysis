<?xml version="1.0" encoding="us-ascii"?>
<!-- ?xml-stylesheet type="text/xsl" href="http://ilcsoft.desy.de/marlin/marlin.xsl"? -->
<!-- ?xml-stylesheet type="text/xsl" href="marlin.xsl"? -->


<!--###############################################
    #                                             #
    #     Example steering file for track fitting #
    #	  Version: $Id$                           #
    #                                             #
    ###############################################-->

<marlin xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ilcsoft.desy.de/marlin/marlin.xsd">

  <execute>
    <processor name="AIDA"/>
    <processor name="LoadPreAlignment"/>
    <processor name="LoadAlignment"/>
    <processor name="ApplyPreAlignment"/>
    <processor name="ApplyAlignment"/>
    <processor name="MyEUTelCorrelator"/>
    <group name="TelDUTHisto"/>
    <processor name="Save"/>
    <processor name="MyEUTelUtilityPrintEventNumber"/>
  </execute>

  <global>
    <parameter name="LCIOInputFiles"> @LcioPath@/@FilePrefix@-hitmaker.slcio </parameter>
    <parameter name="GearXMLFile" value="@GeometryPath@/@GearFile@"/>
    <parameter name="MaxRecordNumber" value="@MaxRecordNumber@"/>
    <parameter name="SkipNEvents" value="0"/>
    <parameter name="SupressCheck" value="false"/>
    <parameter name="Verbosity"> @Verbosity@  </parameter> 
  </global>

  <processor name="AIDA" type="AIDAProcessor">
    <parameter name="Compress" type="int" value="1"/>
    <parameter name="FileName" type="string"> @HistogramPath@/@FilePrefix@-tracking </parameter>
    <parameter name="FileType" type="string" value="root"/>
  </processor>

  <processor name="LoadPreAlignment" type="ConditionsProcessor">
    <parameter name="DBInit" type="string" value="localhost:lccd_test:calvin:hobbes"/>
    <parameter name="SimpleFileHandler" type="StringVec"> prealign @DatabasePath@/@FilePrefix@-prealignment.slcio alignment </parameter>
  </processor>

  <processor name="LoadAlignment" type="ConditionsProcessor">
    <parameter name="DBInit" type="string" value="localhost:lccd_test:calvin:hobbes"/>
    <parameter name="SimpleFileHandler" type="StringVec"> alignment @AlignmentFile@ alignment </parameter>
  </processor>

  <processor name="ApplyPreAlignment" type="EUTelApplyAlignmentProcessor">
    <parameter name="AlignmentConstantName" type="string" lcioInType="LCGenericObject"> prealign </parameter>
    <parameter name="InputHitCollectionName" type="string" lcioInType="TrackerHit"> hit </parameter>
    <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> prealignedhits </parameter>
    <parameter name="ApplyAlignmentDirection" type="int" value="0"/>
    <parameter name="CorrectionMethod" type="int" value="1"/>
    <parameter name="DoAlignCollection" type="bool" value="true"/>
    <parameter name="PrintEvents" type="int" value="10"/>
    <parameter name="alignmentCollectionNames" type="StringVec" value="prealign"/>
    <parameter name="hitCollectionNames" type="StringVec" value="hitCollectionNames"/>
    <parameter name="refhitCollectionNames" type="StringVec" value="hitCollectionNames"/>
    <parameter name="HistogramSwitch" type="bool" value="false"/>
  </processor>

  <processor name="ApplyAlignment" type="EUTelApplyAlignmentProcessor">
    <parameter name="AlignmentConstantName" type="string" lcioInType="LCGenericObject"> alignment </parameter>
    <parameter name="alignmentCollectionNames"> alignment </parameter>
    <parameter name="InputHitCollectionName" type="string" lcioInType="TrackerHit"> prealignedhits </parameter>
    <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> alignedhits </parameter>
    <parameter name="CorrectionMethod" type="int" value="1"/>
    <parameter name="DoAlignCollection" type="bool" value="true"/>
    <parameter name="HistogramSwitch" type="bool" value="false"/>
    <parameter name="DEBUG" type="bool" value="false"/>
    <parameter name="PrintEvents" type="int" value="0"/>
  </processor>

 <processor name="MyEUTelCorrelator" type="EUTelCorrelator">
  <parameter name="InputClusterCollections" type="string" lcioInType="TrackerPulse"> m26_cluster </parameter>
  <parameter name="InputHitCollectionName" type="string" lcioInType="TrackerHit"> alignedhits </parameter>
  <parameter name="ClusterChargeMinimum" type="int" value="2"/>
  <parameter name="DumpOffset" type="bool" value="true"/>
  <parameter name="Events" type="int" value="10000"/>
</processor>

  <group name="TelDUTHisto" >

    <parameter name="Verbosity" type="string" value="@Verbosity@"/>
    <parameter name="alignmentCollectionNames" type="vec" > alignment </parameter>
    <parameter name="InputCollectionName" type="string" lcioInType="TrackerHit"> alignedhits </parameter>
    <parameter name="CorrectedHitCollectionName" type="string" lcioOutType="TrackerHit"> corrhits </parameter>
    <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits </parameter>
    <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> tracks </parameter>
    <parameter name="AllowAmbiguousHits" type="bool" value="false"/>
    <parameter name="AllowMissingHits" type="int" value="@AllowedMissingHits@"/>
    <parameter name="AllowSkipHits" type="int" value="@AllowedSkipHits@ "/>
    <parameter name="UseSlope"   type="bool"  value="true"/>
    <parameter name="SlopeXLimit"   type="float" value="0.01"/>
    <parameter name="SlopeYLimit"   type="float" value="0.01"/>
    <parameter name="SlopeDistanceMax" type="float" value="@DistanceMax@"/>
    <parameter name="Chi2Max" type="double" value="@Chi2Max@"/>
    <parameter name="DebugEventCount" type="int" value="100"/>
    <parameter name="Ebeam" type="double" value="@BeamEnergy@"/>
    <parameter name="HistoInfoFileName" type="string" value="@HistoInfoFile@"/>
    <parameter name="InputHitsInTrack" type="bool" value="true"/>
    <parameter name="MaxPlaneHits" type="int" value="100"/>
    <parameter name="MissingHitPenalty" type="double" value="@MissingHitPenalty@"/>
    <parameter name="OutputHitsInTrack" type="bool" value="true"/>
    <parameter name="PassiveLayerIDs" type="IntVec"> </parameter>
    <parameter name="SearchMultipleTracks" type="bool" value="true"/>
    <parameter name="SkipHitPenalty" type="double" value="@SkipHitPenalty@"/>
    <parameter name="UseBeamConstraint" type="bool" value="true"/>
    <parameter name="UseDUT" type="bool" value="false"/>
    <parameter name="UseNominalResolution" type="bool" value="false"/>
    <parameter name="InputHitCollectionName" type="string" lcioInType="TrackerHit">alignedhits </parameter>
    <parameter name="InputRecHitCollectionName" type="string" lcioInType="TrackerHit">alignedhits </parameter>
    <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> tracks </parameter>
    <parameter name="DUTpitchX" type="double" value="0.018"/>
    <parameter name="DUTpitchY" type="double" value="0.018"/>
    <parameter name="DebugEventCount" type="int" value="1"/>
    <parameter name="DistMax" type="double" value="1.0"/>
    <parameter name="HistoInfoFileName" type="string" value="@HistoInfoFile@"/>
    <parameter name="UseManualDUT" type="bool" value="true"/>
    <parameter name="UseSingleTrackOnly" type="bool" value="false"/>
    <parameter name="onlyIntimeTracks" type="bool" value="false"/>

    <processor name="Fitter00" type="EUTelTestFitter">
      <parameter name="CorrectedHitCollectionName" type="string" lcioOutType="TrackerHit"> corrhits0 </parameter>
      <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits0 </parameter>
      <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> track0 </parameter>
      <parameter name="PassiveLayerIDs" type="IntVec"> 0 </parameter>
    </processor>

    <processor name="DUTHisto00" type="EUTelDUTHistograms">
      <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> track0 </parameter>
      <parameter name="ManualDUTid" type="int" value="0" />
    </processor>

    <processor name="Fitter01" type="EUTelTestFitter">
      <parameter name="CorrectedHitCollectionName" type="string" lcioOutType="TrackerHit"> corrhits1 </parameter>
      <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits1 </parameter>
      <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> track1 </parameter>
      <parameter name="PassiveLayerIDs" type="IntVec">1</parameter>
    </processor>

    <processor name="DUTHisto01" type="EUTelDUTHistograms">
      <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> track1 </parameter>
      <parameter name="ManualDUTid" type="int" value="1" />
    </processor>

    <processor name="Fitter02" type="EUTelTestFitter">
      <parameter name="CorrectedHitCollectionName" type="string" lcioOutType="TrackerHit"> corrhits2 </parameter>
      <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits2 </parameter>
      <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> track2 </parameter>
      <parameter name="PassiveLayerIDs" type="IntVec">2</parameter>
    </processor>

    <processor name="DUTHisto02" type="EUTelDUTHistograms">
      <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> track2 </parameter>
      <parameter name="ManualDUTid" type="int" value="2" />
    </processor>

    <processor name="Fitter03" type="EUTelTestFitter">
      <parameter name="CorrectedHitCollectio    nName" type="string" lcioOutType="TrackerHit"> corrhits3 </parameter>
      <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits3 </parameter>
      <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> track3 </parameter>
      <parameter name="PassiveLayerIDs" type="IntVec">3</parameter>
    </processor>

    <processor name="DUTHisto03" type="EUTelDUTHistograms">
      <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> track3 </parameter>
      <parameter name="ManualDUTid" type="int" value="3" />
    </processor>

    <processor name="Fitter04" type="EUTelTestFitter">
      <parameter name="CorrectedHitCollectionName" type="string" lcioOutType="TrackerHit"> corrhits4 </parameter>
      <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits4 </parameter>
      <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> track4 </parameter>
      <parameter name="PassiveLayerIDs" type="IntVec">4</parameter>
    </processor>

    <processor name="DUTHisto04" type="EUTelDUTHistograms">
      <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> track4 </parameter>
      <parameter name="ManualDUTid" type="int" value="4" />
    </processor>

    <processor name="Fitter05" type="EUTelTestFitter">
      <parameter name="CorrectedHitCollectionName" type="string" lcioOutType="TrackerHit"> corrhits5 </parameter>
      <parameter name="OutputHitCollectionName" type="string" lcioOutType="TrackerHit"> fithits5 </parameter>
      <parameter name="OutputTrackCollectionName" type="string" lcioOutType="Track"> track5 </parameter>
      <parameter name="PassiveLayerIDs" type="IntVec">5</parameter>
    </processor>

    <processor name="DUTHisto05" type="EUTelDUTHistograms">
      <parameter name="InputTrackCollectionName" type="string" lcioInType="Track"> track5 </parameter>
      <parameter name="ManualDUTid" type="int" value="5" />
    </processor>

  </group>

  <processor name="Save" type="EUTelOutputProcessor">
    <parameter name="DropCollectionNames" type="StringVec"> </parameter>
    <parameter name="LCIOOutputFile" type="string" value="@LcioPath@/@FilePrefix@-tracking.slcio"/>
    <parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
    <parameter name="SkipIntermediateEORE" type="bool" value="true"/>
    <parameter name="SplitFileSizekB" type="int" value=""/>
  </processor>

  <processor name="MyEUTelUtilityPrintEventNumber" type="EUTelUtilityPrintEventNumber">
    <parameter name="EveryNEvents" type="int" value="1000"/>
    <parameter name="printTimestamp" type="bool" value="false" />
  </processor>

</marlin>
